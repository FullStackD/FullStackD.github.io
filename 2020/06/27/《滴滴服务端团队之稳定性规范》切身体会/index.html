<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"yoursite.com",root:"/",scheme:"Pisces",version:"8.0.0-rc.3",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!1,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="这里谈谈一些在实际开发中遇到的几个问题。 2.3.监控告警 【强制】线上服务机器必须有基础监控报警，包含CPU、IO、内存、磁盘、coredump、端口 【强制】线上服务必须有基础的服务监控，包括接口qps、fatal数量、耗时   基础监控报警，目前可能未配置报警。服务超时、异常等报警有配置。"><meta property="og:type" content="article"><meta property="og:title" content="《滴滴服务端团队之稳定性规范》切身体会"><meta property="og:url" content="http://yoursite.com/2020/06/27/《滴滴服务端团队之稳定性规范》切身体会/index.html"><meta property="og:site_name" content="不忘初心"><meta property="og:description" content="这里谈谈一些在实际开发中遇到的几个问题。 2.3.监控告警 【强制】线上服务机器必须有基础监控报警，包含CPU、IO、内存、磁盘、coredump、端口 【强制】线上服务必须有基础的服务监控，包括接口qps、fatal数量、耗时   基础监控报警，目前可能未配置报警。服务超时、异常等报警有配置。"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2020-07-15T14:44:12.493Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="《滴滴服务端团队之稳定性规范》切身体会"><meta name="twitter:description" content="这里谈谈一些在实际开发中遇到的几个问题。 2.3.监控告警 【强制】线上服务机器必须有基础监控报警，包含CPU、IO、内存、磁盘、coredump、端口 【强制】线上服务必须有基础的服务监控，包括接口qps、fatal数量、耗时   基础监控报警，目前可能未配置报警。服务超时、异常等报警有配置。"><link rel="canonical" href="http://yoursite.com/2020/06/27/《滴滴服务端团队之稳定性规范》切身体会/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>《滴滴服务端团队之稳定性规范》切身体会 | 不忘初心</title><noscript><style>body{margin-top:2rem}.sidebar-inner,.use-motion .collection-header,.use-motion .comments,.use-motion .header-inner,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">不忘初心</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">少年,专心练剑吧</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-books"><a href="/books/" rel="section"><i class="fa fa-book fa-fw"></i> 书单</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li></ul></nav></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-监控告警"><span class="nav-number">1.</span> <span class="nav-text">2.3.监控告警</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-变更管理"><span class="nav-number">2.</span> <span class="nav-text">2.4.变更管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#反模式3-1-9-没有对非核心流程弱依赖化"><span class="nav-number">3.</span> <span class="nav-text">反模式3.1.9 没有对非核心流程弱依赖化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#反模式3-4-1-代码搭车上线"><span class="nav-number">4.</span> <span class="nav-text">反模式3.4.1 代码搭车上线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#反模式3-4-7-变更没有经过严格的测试"><span class="nav-number">5.</span> <span class="nav-text">反模式3.4.7 变更没有经过严格的测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">6.</span> <span class="nav-text">参考</span></a></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Monster" src="/images/avatar.png"><p class="site-author-name" itemprop="name">Monster</p><div class="site-description" itemprop="description">Stay young, Stay hungry, Stay foolish.</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">13</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">46</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/yourname" title="GitHub → https://github.com/yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:yourname@gmail.com" title="E-Mail → mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://plus.google.com/yourname" title="Google → https://plus.google.com/yourname" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i> Google</a></span></div></section><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></header> <a href="https://github.com/fullstackd" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div id="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/27/《滴滴服务端团队之稳定性规范》切身体会/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Monster"><meta itemprop="description" content="Stay young, Stay hungry, Stay foolish."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="不忘初心"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 《滴滴服务端团队之稳定性规范》切身体会</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-06-27 12:34:39" itemprop="dateCreated datePublished" datetime="2020-06-27T12:34:39+08:00">2020-06-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-07-15 22:44:12" itemprop="dateModified" datetime="2020-07-15T22:44:12+08:00">2020-07-15</time></span></div></header><div class="post-body" itemprop="articleBody"><p>这里谈谈一些在实际开发中遇到的几个问题。</p><h2 id="2-3-监控告警"><a href="#2-3-监控告警" class="headerlink" title="2.3.监控告警"></a>2.3.监控告警</h2><ol><li>【强制】线上服务机器必须有基础监控报警，包含CPU、IO、内存、磁盘、coredump、端口</li><li>【强制】线上服务必须有基础的服务监控，包括接口qps、fatal数量、耗时</li></ol><blockquote><p>基础监控报警，目前可能未配置报警。服务超时、异常等报警有配置。</p></blockquote><a id="more"></a><h2 id="2-4-变更管理"><a href="#2-4-变更管理" class="headerlink" title="2.4.变更管理"></a>2.4.变更管理</h2><ol><li>【强制】任何一级服务变更，均需要走灰度发布机制</li><li>【强制】任何一级服务变更，包括服务变更、配置变更，均需要有相应的回滚预案，保证变更异常时可以快速回退</li></ol><blockquote><ol><li>上线中都需要单点部署后，再全量部署（每个节点有部署间隔）</li><li>上线要检查变更列表，如jar包发布，配置变更，服务调用增加等等是否已完成。 多个服务上线，制定上线顺序以及相应的回滚方案。</li></ol></blockquote><hr><h2 id="反模式3-1-9-没有对非核心流程弱依赖化"><a href="#反模式3-1-9-没有对非核心流程弱依赖化" class="headerlink" title="反模式3.1.9 没有对非核心流程弱依赖化"></a>反模式3.1.9 没有对非核心流程弱依赖化</h2><p>【实例】</p><blockquote><p>没有对流程进行弱依赖化，导致系统整体上比较脆弱，每个依赖单元故障都会导致整个业务瘫痪</p></blockquote><p>【解决方案】</p><blockquote><p>定期对系统的流程进行梳理，最小系统化，非必须流程尽量弱依赖化。</p><p>在项目中，某个流程会调用二方或三方接口，如果该接口出现了异常，也不会影响主流程的结果。例如：不能影响库存服务异常，而导致整个订单查询异常。</p></blockquote><h2 id="反模式3-4-1-代码搭车上线"><a href="#反模式3-4-1-代码搭车上线" class="headerlink" title="反模式3.4.1 代码搭车上线"></a>反模式3.4.1 代码搭车上线</h2><p>【实例】</p><blockquote><p>由于缺乏有效的代码修改管理机制，某产品线由于代码搭车上线，出现过多次线上故障<br>并且由于变更时涉及的修改比较多，导致问题定位和追查时非常困难</p></blockquote><p>【解决方案】</p><blockquote><p>建立严格的代码管理机制，严禁代码搭车上线，保证任何时刻主干没有未上线验证的代码</p><p>这一点其实还蛮多人用的（笑）。个人认为修复一些简单的线上Bug还是可以搭车上线的。</p></blockquote><h2 id="反模式3-4-7-变更没有经过严格的测试"><a href="#反模式3-4-7-变更没有经过严格的测试" class="headerlink" title="反模式3.4.7 变更没有经过严格的测试"></a>反模式3.4.7 变更没有经过严格的测试</h2><p>【实例】</p><blockquote><p>变更较小，感觉没有必要进行测试，结果出现低级错误，导致故障</p></blockquote><p>【解决方案】</p><blockquote><p>任何变更都要测试、double check，修改一行代码，也可能导致线上的稳定性故障</p><p>目前上线流程，都要经过冒烟测试、QA测试、沙箱测试才能上线，且上线后第一时间验证。</p></blockquote><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li>[1] <a href="https://mp.weixin.qq.com/s/gVNKibDQ6UsX_q8_CHvg1A" target="_blank" rel="noopener">五年磨一剑,服务端团队呕心力作之稳定性规范</a></li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-item"><a href="/2020/06/27/Code Review小记/" rel="prev" title="Code Review小记"><i class="fa fa-chevron-left"></i> Code Review小记</a></div><div class="post-nav-item"> <a href="/2020/07/02/lombok原理/" rel="next" title="lombok原理">lombok原理<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Monster</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script></body></html>