<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"yoursite.com",root:"/",scheme:"Pisces",version:"8.0.0-rc.3",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!1,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="前两天有个小朋友问我，lombok插件本地必须安装才可以用，那线上是怎么运行的？虽然知道lombok注解是在编译器生效，但还是一知半解，所以决定查下相关资料总结一下。 首先我们使用lombok是通过注解的方式来实现的，但是在idea并未安装插件的时候，使用自动生成的方法编译器是会报错的。这是因为lombok是使用编译时注解实现的。IDEA 的 lombok 插件不会处理你的代码，只是告诉静态代码分"><meta name="keywords" content="Java,lombok,注解"><meta property="og:type" content="article"><meta property="og:title" content="lombok原理"><meta property="og:url" content="http://yoursite.com/2020/07/02/lombok原理/index.html"><meta property="og:site_name" content="不忘初心"><meta property="og:description" content="前两天有个小朋友问我，lombok插件本地必须安装才可以用，那线上是怎么运行的？虽然知道lombok注解是在编译器生效，但还是一知半解，所以决定查下相关资料总结一下。 首先我们使用lombok是通过注解的方式来实现的，但是在idea并未安装插件的时候，使用自动生成的方法编译器是会报错的。这是因为lombok是使用编译时注解实现的。IDEA 的 lombok 插件不会处理你的代码，只是告诉静态代码分"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2020-07-05T12:13:06.950Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="lombok原理"><meta name="twitter:description" content="前两天有个小朋友问我，lombok插件本地必须安装才可以用，那线上是怎么运行的？虽然知道lombok注解是在编译器生效，但还是一知半解，所以决定查下相关资料总结一下。 首先我们使用lombok是通过注解的方式来实现的，但是在idea并未安装插件的时候，使用自动生成的方法编译器是会报错的。这是因为lombok是使用编译时注解实现的。IDEA 的 lombok 插件不会处理你的代码，只是告诉静态代码分"><link rel="canonical" href="http://yoursite.com/2020/07/02/lombok原理/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>lombok原理 | 不忘初心</title><noscript><style>body{margin-top:2rem}.sidebar-inner,.use-motion .collection-header,.use-motion .comments,.use-motion .header-inner,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">不忘初心</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">少年,专心练剑吧</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-books"><a href="/books/" rel="section"><i class="fa fa-book fa-fw"></i> 书单</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li></ul></nav></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#原理"><span class="nav-number">1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是AST语法树"><span class="nav-number">2.</span> <span class="nav-text">什么是AST语法树</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何修改AST？"><span class="nav-number">3.</span> <span class="nav-text">如何修改AST？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">4.</span> <span class="nav-text">参考</span></a></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Monster" src="/images/avatar.png"><p class="site-author-name" itemprop="name">Monster</p><div class="site-description" itemprop="description">Stay young, Stay hungry, Stay foolish.</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">13</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">44</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/yourname" title="GitHub → https://github.com/yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:yourname@gmail.com" title="E-Mail → mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://plus.google.com/yourname" title="Google → https://plus.google.com/yourname" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i> Google</a></span></div></section><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></header> <a href="https://github.com/fullstackd" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div id="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/02/lombok原理/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Monster"><meta itemprop="description" content="Stay young, Stay hungry, Stay foolish."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="不忘初心"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> lombok原理</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-07-02 08:44:53" itemprop="dateCreated datePublished" datetime="2020-07-02T08:44:53+08:00">2020-07-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-07-05 20:13:06" itemprop="dateModified" datetime="2020-07-05T20:13:06+08:00">2020-07-05</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>前两天有个小朋友问我，lombok插件本地必须安装才可以用，那线上是怎么运行的？虽然知道lombok注解是在编译器生效，但还是一知半解，所以决定查下相关资料总结一下。</p><p>首先我们使用lombok是通过注解的方式来实现的，但是在idea并未安装插件的时候，使用自动生成的方法编译器是会报错的。这是因为lombok是使用编译时注解实现的。IDEA 的 lombok 插件不会处理你的代码，只是告诉静态代码分析工具，这个某些方法已经被注解处理程序实现了，检查时不要报错。</p><p>Java中的注解分为两类</p><ul><li>运行时注解（程序运行时通过反射得到我们注解的信息）</li><li>编译时注解（程序在编译期间通过注解处理器进行处理）</li></ul><p>而lombok需要插件的原因是因为编译器<strong>编译时</strong>通过操作AST(抽象语法树)改变字节码生成。（JAVA的语法树可以理解为java文件的dom模型）</p><a id="more"></a><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><ul><li>定义编译期的注解</li><li>利用JSR269 api(Pluggable Annotation Processing API )创建编译期的注解处理器</li><li>利用tools.jar的javac api处理AST(抽象语法树)</li><li>将功能注册进jar包</li></ul><h2 id="什么是AST语法树"><a href="#什么是AST语法树" class="headerlink" title="什么是AST语法树"></a>什么是AST语法树</h2><p>AST（Abstract syntax tree）即为“抽象语法树”，简称语法树，指代码在计算机内存的一种树状数据结构，便于计算机理解和阅读。</p><p>通过idea中的插件JDT AstView可以看到Java中的抽象语法树。</p><p>包括package信息，imports信息，字段信息和方法信息。</p><p><img data-src="https://i.loli.net/2020/07/05/OLJq6ECntwHrzNS.png" alt="微信截图_20200705192822"><br>这里是Java的编译流程，可以看到在字节码生成之前会先生成抽象语法树。<br><img data-src="https://i.loli.net/2020/07/05/vZf23gMWBmzSp5t.jpg" alt="20131113150025609"></p><h2 id="如何修改AST？"><a href="#如何修改AST？" class="headerlink" title="如何修改AST？"></a>如何修改AST？</h2><ul><li>创建继承AbstractProcessor这个类的注解处理器</li><li>利用tools.jar的javac api处理AST(抽象语法树)</li></ul><p>具体如何写这里就不介绍了，感兴趣的读者可以查一下相关API。</p><p>注：参考链接[3]中简单粗暴的写了一个使用编译时注解实现了将setter方法改造为builder模式的例子。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li>[1] <a href="https://www.jianshu.com/p/fc06578e805a" target="_blank" rel="noopener">Lombok 原理分析与功能实现</a></li><li>[2] <a href="https://mp.weixin.qq.com/s/43s2pEVl7holGzKer8q2bw" target="_blank" rel="noopener">Lombok 天天用，却不知道它的原理是什么？</a></li><li>[3] <a href="https://www.cnblogs.com/throwable/p/9139908.html" target="_blank" rel="noopener">插件化注解处理API(Pluggable Annotation Processing API)</a></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Java/" rel="tag"># Java</a> <a href="/tags/lombok/" rel="tag"># lombok</a> <a href="/tags/注解/" rel="tag"># 注解</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/06/27/《滴滴服务端团队之稳定性规范》切身体会/" rel="prev" title="《滴滴服务端团队之稳定性规范》切身体会"><i class="fa fa-chevron-left"></i> 《滴滴服务端团队之稳定性规范》切身体会</a></div><div class="post-nav-item"> <a href="/2020/07/13/最近读几篇刘未鹏的文章有感/" rel="next" title="最近读刘未鹏的两篇文章有感">最近读刘未鹏的两篇文章有感<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Monster</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script></body></html>